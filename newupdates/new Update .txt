# ğŸ”§ SoundAurora â€” TTS â€œCinsiyet SeÃ§imi + Voice Filtrelemeâ€ YamasÄ±

> Uygulanacak dosyalar: `index.html`, `style.css`, `main.js`
> Hedef: KadÄ±n/Erkek iki tÄ±klama seÃ§eneÄŸi; seÃ§ime gÃ¶re `Voice` listesi otomatik filtrelensin. SaÄŸ Ã¼st **TR** dil butonu aynÄ± kalsÄ±n.

## 1) `index.html` â€” TTS bÃ¶lÃ¼mÃ¼ne cinsiyet seÃ§ici ekle

**Bul:**

```html
<label for="ttsVoice">Voice</label>
<select id="ttsVoice" style="width:100%;padding:10px;border-radius:12px;"></select>
```

**Hemen ÃœSTÃœNE ekle (yeni â€œsegmentedâ€ butonlar):**

```html
<!-- Gender segmented control -->
<div class="segmented" id="ttsGenderGroup" style="margin-bottom:10px;">
  <button type="button" class="segmented-btn active" data-gender="female" id="genderFemale">KadÄ±n</button>
  <button type="button" class="segmented-btn" data-gender="male" id="genderMale">Erkek</button>
</div>
```

> Not: Mevcut `#ttsSection`, `#ttsVoice`, `#ttsRate`, `#ttsPlay`, `#ttsStop`, `#ttsBack` IDâ€™lerine dokunma. Ãœstte sadece yeni bir `#ttsGenderGroup` eklendi.

---

## 2) `style.css` â€” segmented buton stili ekle

**DosyanÄ±n sonuna** ÅŸunu ekle (veya uygun bir yere; mevcut stillere Ã§akÄ±ÅŸmaz):

```css
/* Segmented control (KadÄ±n/Erkek) */
.segmented {
  display: inline-flex;
  gap: 0;
  border: 2px solid #FFD700;
  border-radius: 12px;
  overflow: hidden;
  background: rgba(255,215,0,0.08);
}

.segmented-btn {
  padding: 10px 16px;
  border: none;
  background: transparent;
  color: #FFD700;
  font-weight: 600;
  cursor: pointer;
  transition: all .2s ease;
}

.segmented-btn:not(.active):hover {
  background: rgba(255,215,0,0.12);
}

.segmented-btn.active {
  background: #FFD700;
  color: #0a0a0a;
}
```

---

## 3) `main.js` â€” cinsiyet durumunu yÃ¶net ve Voice listesini filtrele

> Buradaki yama **mevcut TTS inisyalizasyonunu bozmuyor**. Sadece cinsiyeti tutuyor, `/api/voices` ve/veya tarayÄ±cÄ± seslerini **seÃ§ilen cinsiyete gÃ¶re** sÃ¼zÃ¼yor.

### 3.1. En Ã¼ste yakÄ±n bir yere (configlerin altÄ± uygun) **ÅU sabitleri** ekle:

```js
// --- TTS gender support ---
let selectedGender = 'female'; // default
// Sunucu /api/voices cevabÄ±nda gender yoksa isimden tahmin iÃ§in ipucu tablosu:
const VOICE_GENDER_HINTS = {
  // Ã¶rnek id/name kÄ±rpÄ±mlarÄ± â†’ 'female' | 'male'
  'female': ['female','woman','salli','hazel','zoe','aria','jenny','emma','natasha','susan'],
  'male':   ['male','man','tom','guy','daniel','matthew','george','al','adam','guy','tolga']
};
function guessGenderByName(name='') {
  const n = name.toLowerCase();
  if (VOICE_GENDER_HINTS.female.some(k=>n.includes(k))) return 'female';
  if (VOICE_GENDER_HINTS.male.some(k=>n.includes(k))) return 'male';
  return 'unknown';
}
```

### 3.2. TTS elementlerini topladÄ±ÄŸÄ±n yerde **yeni DOMâ€™larÄ± ekle**

(TTS init bloÄŸunda `ttsElements = { ... }` objesine ÅŸu ikisini ekle):

```js
genderGroup: document.getElementById('ttsGenderGroup'),
genderFemaleBtn: document.getElementById('genderFemale'),
genderMaleBtn: document.getElementById('genderMale'),
```

### 3.3. TTS init iÃ§inde **event listener** baÄŸla:

```js
if (ttsElements.genderFemaleBtn && ttsElements.genderMaleBtn) {
  const onGenderClick = (g) => {
    selectedGender = g;                      // state gÃ¼ncelle
    // buton aktiflikleri
    ttsElements.genderFemaleBtn.classList.toggle('active', g==='female');
    ttsElements.genderMaleBtn.classList.toggle('active', g==='male');
    // Voice listesini yeniden yÃ¼kle/filtrele
    populateVoiceSelect();
  };
  ttsElements.genderFemaleBtn.addEventListener('click', ()=> onGenderClick('female'));
  ttsElements.genderMaleBtn.addEventListener('click',   ()=> onGenderClick('male'));
}
```

### 3.4. `loadVoicesForLanguage()` fonksiyonunu **iki aÅŸamalÄ±** hale getir:

* AÅŸama-1: Sunucudan (`/api/voices`) Ã§ek. Gelen objelerde `gender` varsa kullan.
* AÅŸama-2: TarayÄ±cÄ± seslerini eklerken `guessGenderByName()` ile etiketle.
* ArdÄ±ndan **tek bir yerden** selectâ€™i doldur: `populateVoiceSelect()`.

**Mevcut `loadVoicesForLanguage` fonksiyonunu ÅU sÃ¼rÃ¼mle deÄŸiÅŸtir:**

```js
async function loadVoicesForLanguage() {
  if (!ttsElements.voiceSelect) return;

  const selectedLang = (typeof currentLang !== 'undefined' ? currentLang : 'en');
  ttsElements.voiceSelect.innerHTML = '<option value="">Loading voices...</option>';
  availableVoices = [];

  // 1) Sunucu sesleri
  try {
    const res = await fetch('/api/voices');
    if (res.ok) {
      const serverVoices = await res.json(); // {id, name, language, ...[gender?]}
      serverVoices.forEach(v => {
        if (!v.language) return;
        if (v.language.toLowerCase().startsWith(selectedLang.toLowerCase())) {
          availableVoices.push({
            id: v.id,
            name: v.name,
            language: v.language,
            gender: v.gender || guessGenderByName(v.name),
            engine: 'server'
          });
        }
      });
    }
  } catch(e) {
    console.log('Server voices not available:', e);
  }

  // 2) TarayÄ±cÄ± fallback sesleri (isteÄŸe baÄŸlÄ±)
  try {
    const browserVoices = speechSynthesis.getVoices();
    browserVoices.forEach(bv => {
      const lang = (bv.lang || '').toLowerCase();
      const ok =
        (selectedLang === 'tr' && lang.includes('tr')) ||
        (selectedLang === 'en' && lang.includes('en'));
      if (ok) {
        availableVoices.push({
          id: bv.name,
          name: `${bv.name} (Browser)`,
          language: selectedLang,
          gender: guessGenderByName(bv.name),
          engine: 'browser',
          browserVoice: bv
        });
      }
    });
  } catch(e) {
    console.log('Browser voices load error:', e);
  }

  // 3) UI'yi gÃ¼ncelle
  populateVoiceSelect();
}
```

### 3.5. **Yeni yardÄ±mcÄ±:** `populateVoiceSelect()` ekle

(Bu fonksiyon **seÃ§ili cinsiyete gÃ¶re** `availableVoices` listesini sÃ¼zer, selectâ€™i doldurur.)

```js
function populateVoiceSelect() {
  if (!ttsElements.voiceSelect) return;

  // Filtre: seÃ§ili cinsiyet
  const filtered = availableVoices.filter(v => {
    if (!selectedGender || selectedGender==='unknown') return true;
    return (v.gender || 'unknown') === selectedGender;
  });

  // HiÃ§ yoksa â€œNo voicesâ€ gÃ¶ster
  if (!filtered.length) {
    ttsElements.voiceSelect.innerHTML = '<option value="">No voices available for this gender</option>';
    return;
  }

  // Doldur
  ttsElements.voiceSelect.innerHTML = '';
  filtered.forEach(v => {
    const o = document.createElement('option');
    o.value = v.id;
    o.textContent = v.name;
    ttsElements.voiceSelect.appendChild(o);
  });

  // VarsayÄ±lanÄ± ilk elemana ata
  ttsElements.voiceSelect.value = filtered[0].id;
}
```

### 3.6. **TarayÄ±cÄ± TTS kullanÄ±mÄ±nda** seÃ§ilen voiceâ€™Ä± bulurken mevcut mantÄ±ÄŸÄ± bozma

(EÄŸer zaten `generateWithBrowserTTS` iÃ§inde `const selectedVoice = voices.find(v => v.name === formData.voice_id);` kullanÄ±yorsan aynen kalsÄ±n â€” biz selectâ€™e sadece uygunlarÄ± koyduÄŸumuz iÃ§in doÄŸru ses gelecek.)

---

## 4) Dil dÃ¼ÄŸmesi (saÄŸ Ã¼st TR) â€” deÄŸiÅŸiklik YOK

* `#langToggle` mevcut davranÄ±ÅŸÄ±yla kalacak.
* Cinsiyet seÃ§imi ve voice filtreleme, dil toggling ile **Ã§akÄ±ÅŸmaz** (fonksiyonlar ayrÄ±).
* `loadVoicesForLanguage()` zaten dil deÄŸiÅŸince yeniden Ã§aÄŸrÄ±lÄ±yor (Ã§aÄŸrÄ±lmÄ±yorsa, `toggleLanguage()` sonunda bir kere Ã§aÄŸÄ±r).

---

* SaÄŸ Ã¼stteki dÃ¼ÄŸme **â€œyapacaÄŸÄ± diliâ€** yazar.

  * DÃ¼ÄŸmede **TR** yazÄ±yorsa: Site ÅŸu an **Ä°ngilizce**â€™dir; tÄ±klayÄ±nca **TÃ¼rkÃ§e**ye geÃ§er ve dÃ¼ÄŸme metni **EN** olur.
  * DÃ¼ÄŸmede **EN** yazÄ±yorsa: Site ÅŸu an **TÃ¼rkÃ§e**â€™dir; tÄ±klayÄ±nca **Ä°ngilizce**ye geÃ§er ve dÃ¼ÄŸme metni **TR** olur.

Bu davranÄ±ÅŸ zaten kodda var:

* `toggleLanguage()` dili `en â†” tr` deÄŸiÅŸtirir ve `updateLanguageDisplay()` Ã§aÄŸrÄ±lÄ±r.
* `updateLanguageDisplay()` menÃ¼deki tÃ¼m metinleri anÄ±nda o dile Ã§evirir ve dÃ¼ÄŸme metnini ÅŸu kuralla ayarlar:
  `currentLang === 'tr' ? 'EN' : 'TR'` (yani â€œbir sonraki dilâ€ yazsÄ±n).

### 5) Ses listesiyle iliÅŸki 

UI dilini deÄŸiÅŸtirince TTSâ€™teki ses listesini de yeniden yÃ¼klemek istersen, `toggleLanguage()` fonksiyonunun **sonuna** 1 satÄ±r ekleyebilirsin:

```js
function toggleLanguage() {
  currentLang = currentLang === 'tr' ? 'en' : 'tr';
  localStorage.setItem('sa.lang', currentLang);
  updateLanguageDisplay();

  // Ä°STEÄE BAÄLI: UI dili deÄŸiÅŸince voice listesini tazele
  if (typeof loadVoicesForLanguage === 'function') loadVoicesForLanguage();
}
```
Ek Not: loadVoicesForLanguage()â€™da dil kaynaÄŸÄ± currentLang olsun:
const selectedLang = (typeof currentLang !== 'undefined' ? currentLang : 'en');

AnladÄ±m ğŸ‘ Åimdi bu bÃ¶lÃ¼mÃ¼ **tam ve gÃ¼ncel ÅŸekilde** toparlÄ±yorum:
Hem **Ä°ngilizce** hem **TÃ¼rkÃ§e**, TR/EN butonuyla uyumlu, ayrÄ±ca **model lisans linkleri** de dahil olacak.

---

## 6) KullanÄ±lan seslerin free olduklarÄ±nÄ± kanÄ±tlayan linkler (EN + TR)

### 6.1) `index.html` â†’ `<main>` kapanÄ±ÅŸÄ±ndan hemen Ã¶nce ekle

```html
<!-- License Notice Footer -->
<footer class="license-footer">
  <p>
    <span id="licensePrefix">ğŸ”Š All voices are license-free â€”</span>
    <span class="license-tooltip" id="licenseDetailsTrigger">
      <span id="licenseDetails">Details</span>
      <span class="tooltip-content">
        <strong id="tooltipTitle">Open-source Projects & Model Licenses:</strong><br>
        <a href="https://github.com/rhasspy/piper" target="_blank">Piper TTS (Apache-2.0)</a><br>
        <a href="https://huggingface.co/rhasspy/piper-voices" target="_blank">Piper Voices Models</a><br>
        <a href="https://github.com/myshell-ai/OpenVoice" target="_blank">OpenVoice (MIT)</a><br>
        <a href="https://alphacephei.com/vosk/" target="_blank">Vosk STT (Apache-2.0)</a>
      </span>
    </span>
  </p>
</footer>
```

---

### 6.2) `style.css` â†’ dosyanÄ±n sonuna ekle

```css
/* License Footer */
.license-footer {
  text-align: center;
  padding: 20px;
  font-size: 0.95rem;
  color: var(--text-secondary);
  position: relative;
  margin-top: 40px;
}

.license-tooltip {
  position: relative;
  color: #FFD700;
  cursor: pointer;
  font-weight: bold;
}

.tooltip-content {
  visibility: hidden;
  opacity: 0;
  width: 260px;
  background: rgba(0, 0, 0, 0.9);
  color: #fff;
  text-align: left;
  border-radius: 8px;
  padding: 12px;
  position: absolute;
  left: 50%;
  bottom: 125%;
  transform: translateX(-50%);
  z-index: 10;
  transition: opacity 0.3s;
  box-shadow: 0 4px 12px rgba(0,0,0,0.4);
}

.tooltip-content a {
  color: #FFD700;
  text-decoration: none;
}

.tooltip-content a:hover {
  text-decoration: underline;
}

.license-tooltip:hover .tooltip-content {
  visibility: visible;
  opacity: 1;
}
```

---

### 6.3) `main.js` â†’ `updateLanguageDisplay()` iÃ§ine ekle

(Bu blok diÄŸer metinleri gÃ¼ncelledikten sonra Ã§alÄ±ÅŸacak.)

```js
// Footer i18n (license notice)
const lp = document.getElementById('licensePrefix');
const ld = document.getElementById('licenseDetails');
const tt = document.getElementById('tooltipTitle');

if (lp && ld && tt) {
  if (currentLang === 'tr') {
    lp.textContent = 'ğŸ”Š TÃ¼m sesler lisans gerektirmez â€”';
    ld.textContent = 'Detaylar';
    tt.textContent = 'KullanÄ±lan AÃ§Ä±k Kaynak Projeler ve Model LisanslarÄ±:';
  } else {
    lp.textContent = 'ğŸ”Š All voices are license-free â€”';
    ld.textContent = 'Details';
    tt.textContent = 'Open-source Projects & Model Licenses:';
  }
}
```

---

### âœ… SonuÃ§

* **VarsayÄ±lan (EN):** â€œğŸ”Š All voices are license-free â€” Detailsâ€
* **TRâ€™ye geÃ§ince:** â€œğŸ”Š TÃ¼m sesler lisans gerektirmez â€” Detaylarâ€
* Tooltip iÃ§inde **Piper TTS, Piper Voices Models, OpenVoice, Vosk STT** lisans linkleri gÃ¶sterilir.
* TÃ¼m linkler resmi GitHub / HuggingFace / Vosk sayfalarÄ±na gider, bÃ¶ylece **kanÄ±t niteliÄŸi taÅŸÄ±yan kaynak** gÃ¶sterilmiÅŸ olur.

---


